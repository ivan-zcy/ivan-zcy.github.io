<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  

  <!--Author-->
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="POJ3162Walking Race 树形dp+单调队列+模拟vector"/>
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Zcy"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

    <meta name="baidu-site-verification" content="8vgn54BtUC" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- 百度统计 -->
    <script>
	var _hmt = _hmt || [];
	(function() {
  	var hm = document.createElement("script");
  	hm.src = "https://hm.baidu.com/hm.js?c0451e16533956173997b85f7a8de666";
  	var s = document.getElementsByTagName("script")[0]; 
  	s.parentNode.insertBefore(hm, s);
	})();
    </script>
  <!-- Title -->
  
  <title>POJ3162Walking Race 树形dp+单调队列+模拟vector - Zcy</title>


  <link rel="shortcut icon" href="/favicon.ico">
    <!--font-awesome-->
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/thplayer.css">
  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">
    <script src="http://oct3pmpde.bkt.clouddn.com/jquery.js"></script>
</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://graph.baidu.com/resource/180318cdebbb2e5d77c2201543370273.jpg" alt="Zcy" height="60">
        
      </a>
    </div>
    <a class="header-name" href="/">
            <span>Zcy</span>
            的小屋
        </a>
    <!-- navbar -->
    <nav class="navbar">
      <!--  nav links -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  <i class="fa fa-home "></i>
                
                小屋
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  <i class="fa fa-archive "></i>
                
                点滴
              </a>
            </li>
          
            <li>
              <a href="/tags">
                
                  <i class="fa fa-archive "></i>
                
                标签
              </a>
            </li>
          
            <li>
              <a href="/project">
                
                  <i class="fa fa-folder-open "></i>
                
                项目
              </a>
            </li>
          
            <li>
              <a href="/photo">
                
                  <i class="fa fa-photo "></i>
                
                相册
              </a>
            </li>
          
            <li>
              <a href="/guestbook">
                
                  <i class="fa fa-edit "></i>
                
                留言
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  <i class="fa fa-user "></i>
                
                关于我
              </a>
            </li>
          
            <li>
              <a href="/friendly">
                
                  <i class="fa fa-bicycle "></i>
                
                友情链接
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
    <div class="post">
        <!-- Post Content -->
        <div class="container">
            <article>
                <!-- Title date & tags -->
                <div class="post-header">
                    <h1 class="entry-title">
                        POJ3162Walking Race 树形dp+单调队列+模拟vector
                        
                    </h1>

                </div>
                <p class="a-posted-on">
                    2018-11-09
                </p>
                <!-- Post Main Content -->
                <div class="entry-content">
                    <p><img src="/2018/11/09/POJ3162Walking-Race-树形dp-单调队列-模拟vector/titile2.jpg" alt="titile2"></p>
<a id="more"></a>
<p>题意：</p>
<p>Description</p>
<p>flymouse’s sister wc is very capable at sports and her favorite event is walking race. Chasing after the championship in an important competition, she comes to a training center to attend a training course. The center has <em>N</em> check-points numbered 1 through <em>N</em>. Some pairs of check-points are directly connected by two-way paths. The check-points and the paths form exactly a tree-like structure. The course lasts <em>N</em> days. On the <em>i</em>-th day, wc picks check-point <em>i</em> as the starting point and chooses another check-point as the finishing point and walks along the only simple path between the two points for the day’s training. Her choice of finishing point will make it that the resulting path will be the longest among those of all possible choices.</p>
<p>After every day’s training, flymouse will do a physical examination from which data will obtained and analyzed to help wc’s future training be better instructed. In order to make the results reliable, flymouse is not using data all from <em>N</em> days for analysis. flymouse’s model for analysis requires data from a series of consecutive days during which the difference between the longest and the shortest distances wc walks cannot exceed a bound <em>M</em>. The longer the series is, the more accurate the results are. flymouse wants to know the number of days in such a longest series. Can you do the job for him?</p>
<p>Input</p>
<p>The input contains a single test case. The test case starts with a line containing the integers <em>N</em> (<em>N</em> ≤ 106) and <em>M</em> (<em>M</em> &lt; 109). Then follow <em>N</em> − 1 lines, each containing two integers <em>fi</em> and <em>di</em> (i = 1, 2, …, <em>N</em> − 1), meaning the check-points <em>i</em> + 1 and <em>fi</em> are connected by a path of length <em>di</em>.</p>
<p>Output</p>
<p>Output one line with only the desired number of days in the longest series.</p>
<p>Sample Input</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3 2</span><br><span class="line">1 1</span><br><span class="line">1 3</span><br></pre></td></tr></table></figure>
<p>Sample Output</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>
<p>Hint</p>
<p>Explanation for the sample:</p>
<p>There are three check-points. Two paths of lengths 1 and 3 connect check-points 2 and 3 to check-point 1. The three paths along with wc walks are 1-3, 2-1-3 and 3-1-2. And their lengths are 3, 4 and 4. Therefore data from all three days can be used for analysis.</p>
<p>​    翻译成汉语，每个样例输入一个n,m,然后再给出n - 1个边的点权。n个点组成一颗树，求出每个点的离它最远的距离记为a【i】,问连续的区间中差值全部小于等于m的最长区间的长度。</p>
<p>思路：</p>
<p>​    对于求出每个点离它最远的距离a【i】，我们可以通过树形dp来求解（注意需要用链式前向星或者模拟vector来求解，否则TLE），然后再通过尺取+单调队列来求最长长度（当然用线段树也可以求解）。单调队列需要开两个，一个存最大值队列，一个存最小值队列。</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;deque&gt;</span><br><span class="line">#define N 1000005</span><br><span class="line">#define ll long long</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">struct node &#123;</span><br><span class="line">    int inx;</span><br><span class="line">    ll val;</span><br><span class="line">&#125;;</span><br><span class="line">int n, m;</span><br><span class="line">node point[N * 2];</span><br><span class="line">node dp[N][3];</span><br><span class="line">int last[N * 2], fin[N];</span><br><span class="line">deque&lt;int&gt;maxn, minn;</span><br><span class="line"></span><br><span class="line">inline int read() &#123;</span><br><span class="line">    char ch = getchar();</span><br><span class="line">    int x = 0;</span><br><span class="line">    while(ch &lt; &apos;0&apos; || ch &gt; &apos;9&apos;) &#123;</span><br><span class="line">        ch = getchar();</span><br><span class="line">    &#125;</span><br><span class="line">    while(&apos;0&apos; &lt;= ch &amp;&amp; ch &lt;= &apos;9&apos;) &#123;</span><br><span class="line">        x = x * 10 + ch - &apos;0&apos;;</span><br><span class="line">        ch = getchar();</span><br><span class="line">    &#125;</span><br><span class="line">    return x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init() &#123;</span><br><span class="line">    int a, b;</span><br><span class="line">    int tot = 0;</span><br><span class="line">    node c;</span><br><span class="line">    n = read();</span><br><span class="line">    m = read();</span><br><span class="line">    for (int i = 2; i &lt;= n; i++) &#123;</span><br><span class="line">        a = read();</span><br><span class="line">        b = read();</span><br><span class="line">        c.inx = a;</span><br><span class="line">        c.val = b;</span><br><span class="line">        point[++tot] = c;</span><br><span class="line">        last[tot] = fin[i];</span><br><span class="line">        fin[i] = tot;</span><br><span class="line">        c.inx = i;</span><br><span class="line">        point[++tot] = c;</span><br><span class="line">        last[tot] = fin[a];</span><br><span class="line">        fin[a] = tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void dfs (int inx, int father) &#123;</span><br><span class="line">    for (int i = fin[inx]; i != 0; i = last[i]) &#123;</span><br><span class="line">        node son = point[i];</span><br><span class="line">        if (son.inx == father) continue;</span><br><span class="line">        dfs(son.inx, inx);</span><br><span class="line">        if (dp[inx][0].inx == 0) &#123;</span><br><span class="line">            dp[inx][0].val = dp[son.inx][0].val + son.val;</span><br><span class="line">            dp[inx][0].inx = son.inx;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (dp[inx][0].val &lt; dp[son.inx][0].val + son.val) &#123;</span><br><span class="line">                dp[inx][1].val = dp[inx][0].val;</span><br><span class="line">                dp[inx][1].inx = dp[inx][0].inx;</span><br><span class="line">                dp[inx][0].val = dp[son.inx][0].val + son.val;</span><br><span class="line">                dp[inx][0].inx = son.inx;</span><br><span class="line">            &#125; else if (dp[inx][1].val &lt; dp[son.inx][0].val + son.val) &#123;</span><br><span class="line">                dp[inx][1].val = dp[son.inx][0].val + son.val;</span><br><span class="line">                dp[inx][1].inx = son.inx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void dfs1 (int inx, int father) &#123;</span><br><span class="line">    for (int i = fin[inx]; i != 0; i = last[i]) &#123;</span><br><span class="line">        node son = point[i];</span><br><span class="line">        if (son.inx == father) continue;</span><br><span class="line">        if (dp[inx][0].inx == son.inx) &#123;</span><br><span class="line">            dp[son.inx][2].val = son.val + max(dp[inx][1].val, dp[inx][2].val);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            dp[son.inx][2].val = son.val + max(dp[inx][0].val, dp[inx][2].val);</span><br><span class="line">        &#125;</span><br><span class="line">        dfs1(son.inx, inx);</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main () &#123;</span><br><span class="line">    int res = 0;</span><br><span class="line">    init();</span><br><span class="line">    dfs(1, -1);</span><br><span class="line">    dp[1][2].val = 0;</span><br><span class="line">    dfs1(1, -1);</span><br><span class="line">    int start = 1;</span><br><span class="line">    for (int i = 1; i &lt;= n; i++) &#123;</span><br><span class="line">        dp[i][0].val = max(dp[i][0].val, dp[i][2].val);</span><br><span class="line">        while(!maxn.empty() &amp;&amp; dp[maxn.back()][0].val &lt; dp[i][0].val) &#123;</span><br><span class="line">            maxn.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        maxn.push_back(i);</span><br><span class="line">        while(!minn.empty() &amp;&amp; dp[minn.back()][0].val &gt; dp[i][0].val) &#123;</span><br><span class="line">            minn.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        minn.push_back(i);</span><br><span class="line">        while(dp[maxn.front()][0].val - dp[minn.front()][0].val &gt; m) &#123;</span><br><span class="line">            if (maxn.front() &lt; minn.front()) &#123;</span><br><span class="line">                start = maxn.front() + 1;</span><br><span class="line">                maxn.pop_front();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                start = minn.front() + 1;</span><br><span class="line">                minn.pop_front();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res = max(i - start + 1, res);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;%d\n&quot;, res);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    </p>
<p><a href="http://www.ivan-zcy.top">转载请注明出处！！！</a>  </p>
<p>如果有写的不对或者不全面的地方 可通过主页的联系方式进行指正，谢谢</p>

                </div>
            </article>
        </div>
        <!-- Pre or Next -->
        
        <div class="container" >
            <ul class="pager">
                
                <li class="previous">
                    <a href="/2018/11/09/2018icpc青岛Tournament-规律-思维/" rel="prev">下一篇</a>
                </li>
                
                
                <li class="next">
                    <a href="/2018/11/09/2018icpc青岛Flippy-Sequence-思维/" rel="prev">上一篇</a>
                </li>
                
            </ul>
        </div>
        　　　　<!-- Comments -->
        <div class="container">
            
<section id="comment">
  <!-- <h1 class="title">Comments</h1> -->

  
</section>


        </div>
        
        　　　　
    </div>
</div>


  <div id="Thplayer"></div>
  <script type="application/javascript" src="/js/thplayer.min.js"></script>
  <script>
      $("#Thplayer").thplayer({
          title: "遇见",
          author: "孙燕姿",
          cover: "/img/yj.jpg",
          music: "http://www.ytmp3.cn/down/37418.mp3"
      });
  </script>

  <!-- Footer -->
  <!-- top -->
<div id="rocket-to-top">
  <div class="level-2"></div>
  <div class="level-3"></div>
</div>
<script src="http://oct3pmpde.bkt.clouddn.com/top.js"></script>
<script type="text/javascript" src="http://oct3pmpde.bkt.clouddn.com/jquery.js"></script>

<!-- Footer -->
<footer class="site-info">
  <p>
    <span>Zcy &copy; 2018</span>
    
      <span class="split">|</span>
      <span>Zcy</span>
      <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
    
  </p>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  本站总访问量<span id="busuanzi_value_site_pv"></span>次
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
    <p>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
    </p>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("09/28/2018 08:00:00");//此处修改你的建站时间或者网站上线时间
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
          document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
      }
      setInterval("createtime()",250);
  </script>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>


  <script>
      (function(){

          function _scroll(){
              var acticles = $('.article > .container');
              var height = window.innerHeight || document.body.offsetHeight;
              acticles.each(function () {
                  var top = this.getBoundingClientRect().top;
                  if(top < height+1){
                      if(!$(this).hasClass('animated')) {
                          $(this).addClass('slideInRight');
                          $(this).addClass('animated');
                      }
                  }
              })

              $(window).scroll(function () {
                  acticles.each(function () {
                      var top = this.getBoundingClientRect().top;
                      if(top < height+1){
                          if(!$(this).hasClass('animated')) {
                              $(this).addClass('slideInRight');
                              $(this).addClass('animated');
                          }
                      }
                  })
              })
          }


          var bp = document.createElement('script');
          var curProtocol = window.location.protocol.split(':')[0];
          if (curProtocol === 'https') {
              bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
          }
          else {
              bp.src = 'http://push.zhanzhang.baidu.com/push.js';
          }
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(bp, s);
          _scroll();
      })();
  </script>
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/clicklove.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":70,"height":140},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
